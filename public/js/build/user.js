(function(b){function l(a){return 8<a.length?a.substr(0,3)+"-"+a.substr(3,3)+"-"+a.substr(6):8===a.length?a.substr(0,4)+"-"+a.substr(4):a}function m(a){a.preventDefault();var c=b(this);a=b('input[name="short_name"]').val();var d=b('input[name="full_name"]').val();c.find(".has-error, .alert").removeClass("has-error");if(validator.isLength(a,3)&&validator.isLength(d,5)){var n=c.find('button[type="submit"]').button("loading");b.post(c.attr("action"),c.serialize()).always(function(a){n.button("reset")}).done(function(){b('<div class="alert alert-success alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Sucesso,</strong> seu novo nome foi salvo.</div>').prependTo(c).alert()}).fail(function(a){b('<div class="alert alert-success alert-warning"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Erro</strong> - </div>').append(a.responseText).prependTo(c).alert()})}else validator.isLength(a,
3)?c.find('input[name="full_name"]').parent().addClass("has-error"):c.find('input[name="short_name"]').parent().addClass("has-error")}function p(a){a.preventDefault();a=b(this);var c=a.serialize(),d=a.find('input[name="email"]');d.prop("disabled",!0).val("");b.post(a.attr("action"),c).always(function(){d.prop("disabled",!1);e()}).done(function(){d.val("")})}function q(a){a.preventDefault();a=b(this);var c=a.find("input,button").not('[type="hidden"]').each(function(){var a=b(this);a.is("input")&&a.val(a.val().replace(/\D/g,
""))}),d=a.serialize();c.prop("disabled",!0);b.post(a.attr("action"),d).always(function(){c.prop("disabled",!1);f()}).done(function(){c.filter('[name="number"]').val("")})}function r(a){a.preventDefault();var c=b(this),d=c.find("input,button");a=c.serialize();c.find(".has-error").removeClass("has-error");c.find(".alert,.errorLabel,.strengthMeter").remove();b("#newPassword").val()!==b("#repeatPassword").val()?(b("#repeatPassword").parent().addClass("has-error"),b("#repeatPassword").after('<label for=repeatPassword class="control-label errorLabel">N\u00e3o confere</label>')):
3>g.apply(b("#newPassword")).score||(d.prop("disabled",!0),b.post(c.attr("action"),a).always(function(){d.prop("disabled",!1);c.find(".alert,.errorLabel,.strengthMeter").remove()}).done(function(){d.filter("input").val("");b('<div class="alert alert-success alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Sucesso,</strong> sua senha foi alterada.</div>').prependTo(c).alert()}).fail(function(a){b('<div class="alert alert-success alert-warning"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Senha n\u00e3o alterada</strong> - </div>').append(a.responseText).prependTo(c).alert()}))}
function g(){var a=b(this),c=zxcvbn(a.val(),["senha","dif\u00edcil","f\u00e1cil",b('input[name="short_name"]').val()].concat(b('input[name="full_name"]').val().split(" ")));a.next(".strengthMeter").remove();a=b('<label class="control-label strengthMeter">').insertAfter(a);1>=c.score?a.addClass("text-danger").text("Trivial"):2===c.score?a.addClass("text-warning").text("Fraca"):4>c.score?a.addClass("text-info").text("Suficiente"):a.addClass("text-success").text("Forte");return c}function s(){if(!b(this).data("locked")){var a=
b(this).closest("ul");if(2>a.children().length)a.prev().is(".alert")||b('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Ops...</strong> N\u00e3o \u00e9 poss\u00edvel remover todos os emails de um usu\u00e1rio.</div>').insertBefore(a).alert();else{var c=b(this).data("locked",!0).text("..."),d=c.parent(),a=d.children("span").text();b.ajax("/user/email",{type:"DELETE",data:{email:a}}).always(function(){c.data("locked",
!1).html("&times;")}).done(function(){d.remove()})}}}function t(){if(!b(this).data("locked")){var a=b(this).data("locked",!0).text("..."),c=a.parent();b.ajax("/user/tel",{type:"DELETE",data:{tel:a.data("id")}}).always(function(){a.data("locked",!1).html("&times;")}).done(function(){c.remove()})}}function e(){b.getJSON("/user/email",function(a){var c=b("#emailList").empty(),d;a.forEach(function(a){d=b("<li>").addClass("list-group-item").appendTo(c);d.append("<span>"+a+"</span>");b("<a aria-hidden=true>").addClass("close").html("&times;").attr("title",
"Remover").click(s).appendTo(d)})})}function f(){b.getJSON("/user/tel",function(a){var c=b("#telList").empty(),d;a.forEach(function(a){d=b("<li>").addClass("list-group-item").appendTo(c);d.append("<span class='badge'>"+a.area+"</span>"+l(a.number));b("<a aria-hidden=true>").addClass("close").html("&times;").attr("title","Remover").data("id",a.id).click(t).appendTo(d)})})}var u=b("#userNameForm"),v=b("#userEmailForm"),h=b("#userTelForm"),w=b("#userPasswordForm"),k={};LazyLoad.js(["/js/ext/validator.js/validator.min.js",
"/js/ext/zxcvbn/zxcvbn.js"],function(){e();f();b.getJSON("/json/ddd.json",function(a){!a instanceof Array||a.forEach(function(a){if(a instanceof Array){var b=a.shift();k[b]=a.join(", ")}})}).always(function(){function a(){var a=b(this).val(),a=k[a]||"";b(this).parent().find(".text-info").html(a)}h.submit(q);var c=h.find('[name="area"]');c.on("input",a);a.apply(c)});u.submit(m);v.submit(p);w.submit(r);b("#newPassword").on("input",g)})})(jQuery);
