(function(k,e){function g(){this.id=null;this.full_name=this.short_name="";this.emails=[];this.tels=[];this.isAdmin=!1;this.avatar=null;this.name="";this.active=!0}var h=k.acw,f=h.components,a=k.React,l=f.StdList,r=f.UserAvatar,m=f.ContactList,n,p,q,s=f.AlertList;p=a.createClass({displayName:"OrgApp",getInitialState:function(){return{enabled:this.props.enabled}},componentWillReceiveProps:function(b){this.setState({enabled:b.enabled})},toggleApp:function(b){this.setState({enabled:b.currentTarget.checked});
e.ajax("/admin/org_app/"+this.props.org_app+"/user/"+this.props.user,{type:b.currentTarget.checked?"POST":"DELETE"})},render:function(){return a.DOM.div({className:"checkbox"},a.DOM.label(null,a.DOM.input({type:"checkbox",checked:this.state.enabled,onChange:this.toggleApp}),this.props.abbr))}});n=a.createClass({displayName:"OrgApps",getInitialState:function(){return{apps:[]}},componentWillReceiveProps:function(b){this.reloadList(b)},componentDidMount:function(){this.reloadList(this.props)},reloadList:function(b){e.get("/admin/org/"+
b.org+"/user/"+b.user+"/apps").done(function(b){this.setState({apps:b})}.bind(this))},render:function(){return a.DOM.div(null,a.DOM.h5(null,"Aplicativos Dispon\u00edveis"),_.map(this.state.apps,function(b){return p({key:b.id,enabled:b.enabled,name:b.name,abbr:b.abbr,org_app:b.org_app,user:this.props.user})}.bind(this)))}});q=a.createClass({displayName:"UserForm",mixins:[a.addons.LinkedStateMixin],getInitialState:function(){var b=this.props.user;b.emailAlerts={};return b},userState:function(){var b=
_.merge({},this.state);delete b.emailAlerts;return b},setNewEmail:function(b){b.preventDefault();b=this.refs.newEmail.getDOMNode();var a=this.userState(),d=b.value;a.emails=a.emails.concat([d]);this.props.setSelected(a,!0);e.post("/admin/user/"+this.state.id+"/email",{email:d}).fail(function(b){var a=this.state.emailAlerts,c=this.state.emails.filter(function(a){return a!==d});a[h.uniqueId()]=["danger",b.responseText];this.setState({emailAlerts:a});setTimeout(function(){this.setState({emails:c})}.bind(this),
2E3)}.bind(this));b.value=""},lookForEmail:function(a){a.preventDefault();var c=this.refs.newEmail.getDOMNode();a=c.value;c.disabled=!0;e.get("/admin/org/"+this.props.org+"/user",{email:a}).done(function(a){a&&this.props.setSelected(a)}.bind(this)).fail(function(a){var b=this.state.emailAlerts;b[h.uniqueId()]=["warning",a.responseText];this.setState({emailAlerts:b})}.bind(this)).always(function(){c.value="";c.disabled=!1})},dismissEmailAlerts:function(a){var c=this.state.emailAlerts;delete c[a];this.setState({emailAlerts:c})},
componentWillReceiveProps:function(a){this.setState(a.user)},mainSubmit:function(a){a.preventDefault();e.post("/admin/org/"+this.props.org+"/user",e(a.currentTarget).serialize()).done(function(a){var b=this.userState();b.id=a;this.props.setSelected(b,!0)}.bind(this))},toggleUser:function(a){var c="/admin/org/"+this.props.org+"/user/"+this.state.id,d=this.userState();d.active=a.currentTarget.checked;this.props.setSelected(d,!0);e.ajax(c,{type:a.currentTarget.checked?"POST":"DELETE"})},toggleAdmin:function(a){var c=
"/admin/org/"+this.props.org+"/user/"+this.state.id+"/admin",d=this.userState();d.isAdmin=a.currentTarget.checked;this.props.setSelected(d,!0);e.ajax(c,{type:a.currentTarget.checked?"POST":"DELETE"})},render:function(){return a.DOM.div({className:"jumbotron"},a.DOM.form({onSubmit:this.mainSubmit,role:"form"},a.DOM.div({className:"row"},a.DOM.div({className:"col-md-3 userAvatarThumbContainer"},a.DOM.span(null),r({src:this.state.avatar})),a.DOM.div({className:"col-md-9"},a.DOM.div({className:"row"},
a.DOM.div({className:"col-md-5"},a.DOM.div({className:"form-group"},a.DOM.label({htmlFor:"orgUserShortName"},"Nome"),a.DOM.input({id:"orgUserShortName",name:"short_name",className:"form-control",type:"text",required:!0,readOnly:null!==this.state.id,valueLink:this.linkState("short_name")}))),a.DOM.div({className:"col-md-7"},a.DOM.div({className:"form-group"},a.DOM.label({htmlFor:"orgUserFullName"},"Completo"),a.DOM.input({id:"orgUserFullName",name:"full_name",className:"form-control",type:"text",required:!0,
readOnly:null!==this.state.id,valueLink:this.linkState("full_name")})))),null===this.state.id&&a.DOM.div({className:"text-right"},a.DOM.button({type:"submit",className:"btn btn-default"},"Salvar"))))),a.DOM.div({className:"row"},a.DOM.div({className:"col-md-6"},a.DOM.form({role:"form",onSubmit:this.state.id?this.setNewEmail:this.lookForEmail},a.DOM.div({className:"form-group"},s({alerts:this.state.emailAlerts,dismissAlert:this.dismissEmailAlerts}),a.DOM.input({ref:"newEmail",name:"email",type:"email",
className:"form-control",required:!0,placeholder:this.state.id?"Novo email":"Buscar por email"}))),this.state.id&&m({list:this.state.emails}),this.state.id&&m({list:this.state.tels})),a.DOM.div({className:"col-md-6"},a.DOM.div({className:"checkbox"},a.DOM.label(null,a.DOM.input({type:"checkbox",checked:this.state.active||this.state.isAdmin,disabled:null===this.state.id||this.state.isAdmin,onChange:this.toggleUser}),"Funcion\u00e1rio ativo")),a.DOM.div({className:"checkbox"},a.DOM.label(null,a.DOM.input({type:"checkbox",
checked:this.state.isAdmin,disabled:null===this.state.id,onChange:this.toggleAdmin})," Administrador")),this.state.id&&this.state.active&&n({org:this.props.org,user:this.state.id}))))}});f.OrgUserManager=a.createClass({displayName:"OrgUserManager",getInitialState:function(){return{selectedOrg:{id:null},selectedUser:new g,forceUpdate:(new Date).getTime()}},setSelectedUser:function(a,c){var d={selectedUser:c||a.id!==this.state.selectedUser.id?a:new g};c&&(d.forceUpdate=(new Date).getTime());this.setState(d)},
setSelectedOrg:function(a,c){var d={selectedOrg:c||a.id!==this.state.selectedOrg.id?a:{id:null}};d.selectedOrg.id!==this.state.selectedOrg.id&&(d.selectedUser=new g);this.setState(d)},render:function(){return a.DOM.div({className:"row"},a.DOM.div({className:"col-md-3"},a.DOM.h5(null,"Suas organiza\u00e7\u00f5es"),l({uri:"/admin/orgs/users",selected:this.state.selectedOrg,setSelected:this.setSelectedOrg})),a.DOM.div({className:"col-md-3"},a.DOM.h5(null,"Usu\u00e1rios"),l({uri:this.state.selectedOrg.id?
"/admin/org/"+this.state.selectedOrg.id+"/users":null,selected:this.state.selectedUser,forceUpdate:this.state.forceUpdate,setSelected:this.setSelectedUser})),a.DOM.div({className:"col-md-6"},a.DOM.h5(null,"Usu\u00e1rio"),this.state.selectedOrg.id&&q({org:this.state.selectedOrg.id,user:this.state.selectedUser,setSelected:this.setSelectedUser})))}})})(window,jQuery);
