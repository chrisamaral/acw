(function(h,e){function f(a){var c,d;c=String(a.getFullYear());d=String(a.getMonth()+1);1===d.length&&(d="0"+d);a=String(a.getDate());1===a.length&&(a="0"+a);return a+"/"+d+"/"+c}var g=h.acw.components,a=h.React,k,l,m=g.ContactList,p=g.UserAvatar,n;n=a.createClass({displayName:"UserOrgsInfo",getInitialState:function(){return{orgs:[]}},componentDidMount:function(){this.reloadOrgs(this.props.user)},componentWillReceiveProps:function(a){this.reloadOrgs(a.user)},reloadOrgs:function(a){e.get("/admin/user/"+
a+"/orgs").done(function(a){this.setState({orgs:a})}.bind(this))},render:function(){return a.DOM.ul(null,this.state.orgs.map(function(b){return a.DOM.li({key:b.id},a.DOM.h4(null,b.org+"    \u2013   ",a.DOM.small(null,b.roles)),a.DOM.ul(null,b.apps.map(function(b){return a.DOM.li({key:b},b)})))}))}});l=a.createClass({displayName:"ExistingUserForm",setNewEmail:function(a){a.preventDefault();a=this.refs.newEmail.getDOMNode();this.props.newUserEmail(a.value);a.value=""},render:function(){return a.DOM.div({className:"ExistingUserForm"},
a.DOM.div({className:"row"},a.DOM.div({className:"col-md-5"},a.DOM.form({role:"form",onSubmit:this.setNewEmail},a.DOM.div({className:"form-group"},a.DOM.input({ref:"newEmail",name:"email",type:"email",className:"form-control",required:!0,placeholder:"Novo email"}))),m({list:this.props.emails}),m({list:this.props.tels})),a.DOM.div({className:"col-md-7"},n({user:this.props.user}))))}});k=a.createClass({displayName:"SelectedUser",mixins:[a.addons.LinkedStateMixin],submitUserChanges:function(a){var c=
a.currentTarget,d=this.refs.submitUserChanges.getDOMNode();d.disabled=!0;e.post(c.action,e(c).serialize(),"text").done(function(a){this.props.selectUser(a)}.bind(this)).always(function(){d.disabled=!1});a.preventDefault()},setAdmin:function(a){this.setState({isAdmin:a.currentTarget.checked})},newUserEmail:function(a){this.setState({emails:this.state.emails.concat([a])});e.post("/admin/user/"+this.props.user+"/email",{email:a})},setExpiration:function(a){a.preventDefault();this.setState({expiration:f(new Date)})},
activeUserNow:function(a){a.preventDefault();this.setState({init:f(new Date),disabled:!1})},disableUserNow:function(){this.setState({expiration:f(new Date),disabled:!0})},getInitialState:function(){return{full_name:"",short_name:"",emails:[],tels:[],avatar:null,init:null,expiration:null,disabled:!0,wasDisabled:!0,isAdmin:!1}},componentWillReceiveProps:function(a){this.loadUser(a)},loadUser:function(a){if(!a.user)return this.setState(this.getInitialState());e.get("/admin/user/"+a.user).done(function(a){a.disabled=
null===a.init;a.wasDisabled=a.disabled;this.setState(a)}.bind(this))},componentDidUpdate:function(){function a(){!c.state.disabled&&c.state.expiration&&e("#setUserExpiration").datepicker({format:"dd/mm/yyyy",startDate:new Date})}if(!this.state.disabled){var c=this;if(e.fn.datepicker)return a();LazyLoad.css(["/js/ext/bootstrap-datepicker/datepicker.css"]);LazyLoad.js(["/js/ext/bootstrap-datepicker/js/bootstrap-datepicker.min.js"],a)}},render:function(){var b=a.DOM.div({className:"userSwitch"},a.DOM.div({className:"form-group row"},
a.DOM.div({className:"col-md-6"},a.DOM.label(null,"Usu\u00e1rio ativado em"),a.DOM.p({type:"text",className:"form-control-static"},this.state.init)),a.DOM.div({className:"col-md-6"},a.DOM.label({htmlFor:"setUserExpiration"},"Data de expira\u00e7\u00e3o"),this.state.expiration?a.DOM.div({className:"input-group"},a.DOM.input({type:"text",name:"expiration",valueLink:this.linkState("expiration"),id:"setUserExpiration",className:"date-picker form-control"}),a.DOM.span({className:"input-group-btn"},a.DOM.button({onClick:this.disableUserNow,
className:"btn btn-danger",type:"button"},"Desativar"))):a.DOM.p(null,a.DOM.input({type:"hidden",name:"expiration",value:null,id:"setUserExpiration"}),"nunca \u2015 ",a.DOM.a({href:"#",onClick:this.setExpiration},"mudar")))));this.state.disabled&&(b=a.DOM.p({className:"text-danger userSwitch"},a.DOM.strong(null,"Usu\u00e1rio desativado, ",a.DOM.a({href:"#",onClick:this.activeUserNow},"ativar"))));return a.DOM.div({className:"selectedUser jumbotron"},a.DOM.form({onSubmit:this.submitUserChanges,action:"/admin/user"+
(this.props.user?"/"+this.props.user:""),method:"POST"},a.DOM.div({className:"row"},a.DOM.div({className:"col-md-3 userAvatarThumbContainer"},a.DOM.span(null),p({src:this.state.avatar})),a.DOM.div({className:"col-md-9"},a.DOM.div({className:"row"},a.DOM.div({className:"col-md-4"},a.DOM.div({className:"form-group"},a.DOM.label({htmlFor:"userShortName"},"Nome"),a.DOM.input({id:"userShortName",name:"short_name",className:"form-control",type:"text",required:!0,readOnly:null!==this.props.user,valueLink:this.linkState("short_name")}))),
a.DOM.div({className:"col-md-8"},a.DOM.div({className:"form-group"},a.DOM.label({htmlFor:"userFullName"},"Completo"),a.DOM.input({id:"userFullName",name:"full_name",className:"form-control",type:"text",required:!0,readOnly:null!==this.props.user,valueLink:this.linkState("full_name")})))),b,a.DOM.div({className:"row"},a.DOM.div({className:"col-md-8"},a.DOM.div({className:"checkbox"},a.DOM.label(null,a.DOM.input({type:"checkbox",disabled:this.state.disabled,name:"isAdmin",value:"on",onChange:this.setAdmin,
checked:!this.state.disabled&&this.state.isAdmin}),"Administrador"))),a.DOM.div({className:"col-md-4"},a.DOM.button({ref:"submitUserChanges",type:"submit",className:"btn btn-default"},"Salvar")))))),this.props.user?l({user:this.props.user,newUserEmail:this.newUserEmail,emails:this.state.emails,tels:this.state.tels}):"")}});g.SelectedUser=k})(window,jQuery);
