(function(h,r){function k(){this.id=null;this.name=this.abbr="";this.active=!1;this.icon=null}var g=h.acw,f=g.components,a=h.React,m=f.StdList,n=f.StdForm,l,p=f.ProgressBar,q=f.AlertList;l=a.createClass({displayName:"AppIconForm",mixins:[a.addons.LinkedStateMixin],getInitialState:function(){return{preview:null,alerts:{},uploadProgress:0}},removePreview:function(a){a.preventDefault();this.setState({preview:null});this.refs.appIconPreview.getDOMNode().value=""},loadPreview:function(c){var b=c.currentTarget;
c=new FileReader;var b=b.files[0],d=this.state.alerts;if(!b)return this.refs.appIconPreview.getDOMNode().value="",this.setState({preview:null});if(!/^(image\/jpeg|image\/png)$/i.test(b.type))return d[g.uniqueId()]=["danger",a.DOM.div(null,a.DOM.strong(null,"Formato inv\u00e1lido!")," Os formatos v\u00e1lidos s\u00e3o ",a.DOM.strong(null,"jpeg")," e ",a.DOM.strong(null,"png"))],this.refs.appIconPreview.getDOMNode().value="",this.setState({preview:null,alerts:d});c.onload=function(a){this.setState({preview:a.target.result})}.bind(this);
c.readAsDataURL(b)},dismissAlert:function(a){var b=this.state.alerts;delete b[a];this.setState({alerts:b})},handleSubmit:function(c){c.preventDefault();var b=new FormData(c.currentTarget),d=new XMLHttpRequest,e=this;d.open("POST",c.currentTarget.action,!0);d.onload=function(c){c=e.state.alerts;200===this.status?(e.props.setIcon(this.responseText),e.setState({preview:null})):(c[g.uniqueId()]=["danger",a.DOM.div(null,a.DOM.strong(null,this.responseText)," N\u00e3o foi poss\u00edvel salvar o novo \u00edcone")],
e.setState({alerts:c,preview:null}));setTimeout(function(){e.setState({uploadProgress:0})},1E3);e.refs.appIconPreview.getDOMNode().value=""};d.upload.onprogress=function(a){a.lengthComputable&&e.setState({uploadProgress:a.loaded/a.total*100})};d.send(b)},render:function(){return a.DOM.form({onSubmit:this.handleSubmit,role:"form",action:"/admin/app/"+this.props.id+"/icon",encType:"multipart/form-data"},a.DOM.input({name:"id",type:"hidden",value:this.props.id}),a.DOM.div({className:"iconPreview"},a.DOM.span({className:"helper"}),
a.DOM.img({className:"originalIcon",src:this.props.icon?this.props.icon:"/img/none.png"}),a.DOM.span({className:"glyphicon glyphicon-hand-right"}),a.DOM.img({className:"previewIcon",src:this.state.preview?this.state.preview:"/img/none.png"})),q({alerts:this.state.alerts,dismissAlert:this.dismissAlert}),a.DOM.div({className:"input-group"},a.DOM.input({ref:"appIconPreview",name:"icon",onChange:this.loadPreview,type:"file",required:!0,className:"form-control"}),a.DOM.div({className:"input-group-btn"},
a.DOM.button({className:"btn btn-danger",onClick:this.removePreview},"Cancelar"),a.DOM.button({className:"btn btn-success",type:"submit"},"Salvar"))),this.state.uploadProgress?p({progress:this.state.uploadProgress}):null)}});f.AppManager=a.createClass({displayName:"AppManager",getInitialState:function(){return{selected:new k,forceUpdate:(new Date).getTime()}},setSelected:function(a,b){var d={selected:b||a.id!==this.state.selected.id?a:new k};b&&(d.forceUpdate=(new Date).getTime());this.setState(d)},
setIcon:function(a){this.setState({selected:_.merge(this.state.selected,{icon:a})})},render:function(){return a.DOM.div({className:"row"},a.DOM.div({className:"col-md-4"},m({uri:"/admin/apps",forceUpdate:this.state.forceUpdate,selected:this.state.selected,setSelected:this.setSelected})),a.DOM.div({className:"col-md-8"},n({action:"/admin/app",item:this.state.selected,iname:"aplicativo",setSelected:this.setSelected}),this.state.selected.id?l({setIcon:this.setIcon,id:this.state.selected.id,icon:this.state.selected.icon}):
null))}})})(window,jQuery);
