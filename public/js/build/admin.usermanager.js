(function(f,e){var g=f.acw.components,a=f.React,k,h,l;l=a.createClass({displayName:"UserSearch",handleChange:function(){var a=this.refs.activeUsersOnlyInput.getDOMNode(),c=this.refs.filterTextInput.getDOMNode().value;this.props.onUserInput(c,a.checked)},render:function(){return a.DOM.form({role:"form"},a.DOM.div({className:"form-group"},a.DOM.label({className:"sr-only",htmlFor:"UserSearchInput"},"Termo de busca"),a.DOM.input({id:"UserSearchInput",type:"search",placeholder:"Busque pelo Nome/Email",
ref:"filterTextInput",onChange:this.handleChange,className:"form-control",value:this.props.filterText})),a.DOM.div({className:"checkbox"},a.DOM.label(null,a.DOM.input({type:"checkbox",ref:"activeUsersOnlyInput",disabled:!this.props.filterText.length,onChange:this.handleChange,checked:0<this.props.filterText.length?this.props.activeUsersOnly:!0,value:this.props.activeUsersOnly}),"Apenas usu\u00e1rios ativos")))}});h=g.StdListItem;(function(){var d;k=a.createClass({displayName:"UserList",scrollChange:function(a){var b=
this.refs.userList.getDOMNode();clearTimeout(d);d=setTimeout(function(){var a=b.scrollTop,c=0.1*b.scrollHeight;10>a&&(this.props.onOffsetChange("up"),this.props.reachedTop||e(b).animate({scrollTop:a+c}));10>b.scrollHeight-(a+e(b).height())&&(this.props.onOffsetChange("down"),this.props.reachedBottom||e(b).animate({scrollTop:a-c}))}.bind(this),1E3)},render:function(){var c=this.props.selectedUser;return a.DOM.div({className:"stdList list-group"},c?a.DOM.div({className:"selected"},h({key:c.id,item:{id:c.id,
name:c.full_name,abbr:c.short_name,active:c.active},onClick:this.props.onUserClick,selected:!0})):null,a.DOM.div({className:"others",ref:"userList",onScroll:this.scrollChange},this.props.users.map(function(b,a){return h({key:b.id,item:{id:b.id,name:b.full_name,abbr:b.short_name,active:b.active},onClick:this.props.onUserClick,selected:!1})}.bind(this))))}})})();(function(){var d,c;g.UserManager=a.createClass({displayName:"UserManager",getInitialState:function(){return{users:[],formLoaded:!1,selectedUser:null,
reachedBottom:!1,reachedTop:!0,query:{filterText:"",activeUsersOnly:!0,offset:0}}},onUserUpdate:function(b){(b=b&&b.length?b:null)&&this.setState({selectedUser:b});this.reloadList()},selectUser:function(b){b=b.id;b=this.state.selectedUser===b?null:b;this.setState({selectedUser:b})},componentDidMount:function(){LazyLoad.js(["/js/"+f.jsPath+"/admin.usermanager.form.js"],function(){this.setState({formLoaded:!0});this.reloadList()}.bind(this))},offsetChange:function(b){var a=this.state.query.offset;b=
10>a&&"up"===b?0:"up"===b?a-10:a+10;a!==b&&(this.setState({query:_.merge(this.state.query,{offset:b})}),this.reloadList())},searchInputChange:function(b,a){this.setState({query:_.merge(this.state.query,{filterText:b,activeUsersOnly:0<b.length?a:!0})});clearTimeout(d);d=setTimeout(function(){this.reloadList()}.bind(this),500)},reloadList:function(){var b=this.state.query.offset,a=_.merge({},this.state.query);this.state.selectedUser&&(a.user=this.state.selectedUser);e.get("/admin/users",a).done(function(a){this.setState({users:a.users,
reachedTop:0===a.offset,reachedBottom:a.offset<b,query:_.merge(this.state.query,{offset:a.offset})})}.bind(this))},render:function(){var b="...",d=this.state.selectedUser;this.state.formLoaded&&(c=g.SelectedUser,b=c({user:this.state.selectedUser,selectUser:this.onUserUpdate}));return a.DOM.div({className:"row userTabWrapper"},a.DOM.div({className:"col-md-4"},l({activeUsersOnly:this.state.query.activeUsersOnly,filterText:this.state.query.filterText,onUserInput:this.searchInputChange}),k({users:this.state.users.filter(function(a){return a.id!==
d}),selectedUser:this.state.users.filter(function(a){return a.id===d})[0],onUserClick:this.selectUser,onOffsetChange:this.offsetChange,reachedTop:this.state.reachedTop,reachedBottom:this.state.reachedBottom})),a.DOM.div({className:"col-md-8"},b))}})})()})(window,jQuery);
